<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å…«å­—æ‹©å‰ä»»åŠ¡æ¨è</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
      font-size: 1.1em;
    }
    
    input, select, button {
      padding: 12px;
      font-size: 16px;
      width: 100%;
      max-width: 400px;
      border: 2px solid #ddd;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 20px;
      transition: transform 0.2s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    #result {
      margin-top: 30px;
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.8;
      background: #f8f9fa;
      padding: 25px;
      border-radius: 10px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
      border-left: 5px solid #667eea;
      font-family: 'Courier New', monospace;
      line-height: 1.6;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .loading {
      text-align: center;
      color: #667eea;
      font-size: 1.2em;
    }
    
    .error {
      color: #e74c3c;
      background: #fdf2f2;
      border-left-color: #e74c3c;
    }
    
    .success {
      color: #27ae60;
    }
    
    .highlight {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”® Academic god</h1>

    <div class="form-group">
      <label for="birth">ğŸ“… å‡ºç”Ÿæ—¥æœŸæ—¶é—´</label>
      <input type="datetime-local" id="birth" />
    </div>

    <div class="form-group">
      <label for="gender">ğŸ‘¤ æ€§åˆ«</label>
      <select id="gender">
        <option value="1">ç”·</option>
        <option value="0">å¥³</option>
      </select>
    </div>

    <div class="form-group">
      <label for="task">ğŸ“ ä»»åŠ¡ç±»å‹</label>
      <select id="task">
        <option value="æŠ•ç¨¿">ğŸ“„ æŠ•ç¨¿</option>
        <option value="è¿”ä¿®">âœï¸ è¿”ä¿®</option>
        <option value="ç›²å®¡">ğŸ‘ï¸ ç›²å®¡</option>
        <option value="ç­”è¾©">ğŸ“ ç­”è¾©</option>
      </select>
    </div>

    <div class="form-group">
      <label for="days">ğŸ“Š åˆ†æå¤©æ•°ï¼ˆ1-365å¤©ï¼‰</label>
      <input type="number" id="days" min="1" max="365" value="30" />
    </div>

    <button onclick="submitForm()">ğŸš€ å¼€å§‹åˆ†æ</button>

    <div id="result"></div>
  </div>

  <script>
    // ==================== å…«å­—è®¡ç®—æ ¸å¿ƒç®—æ³• ====================
    
    // å¤©å¹²åœ°æ”¯æ•°æ®
    const TIANGAN = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
    const DIZHI = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
    
    // å¤©å¹²äº”è¡Œæ˜ å°„
    const GAN_WUXING = {
      "ç”²": "æœ¨", "ä¹™": "æœ¨", "ä¸™": "ç«", "ä¸": "ç«", "æˆŠ": "åœŸ", "å·±": "åœŸ",
      "åºš": "é‡‘", "è¾›": "é‡‘", "å£¬": "æ°´", "ç™¸": "æ°´"
    };
    
    // åœ°æ”¯äº”è¡Œæ˜ å°„
    const ZHI_WUXING = {
      "å­": "æ°´", "ä¸‘": "åœŸ", "å¯…": "æœ¨", "å¯": "æœ¨",
      "è¾°": "åœŸ", "å·³": "ç«", "åˆ": "ç«", "æœª": "åœŸ",
      "ç”³": "é‡‘", "é…‰": "é‡‘", "æˆŒ": "åœŸ", "äº¥": "æ°´"
    };
    
    // åœ°æ”¯è—å¹²æ˜ å°„
    const ZHI_CANGGAN = {
      "å­": ["ç™¸"], "ä¸‘": ["å·±", "ç™¸", "è¾›"], "å¯…": ["ç”²", "ä¸™", "æˆŠ"], "å¯": ["ä¹™"],
      "è¾°": ["æˆŠ", "ä¹™", "ç™¸"], "å·³": ["ä¸™", "åºš", "æˆŠ"], "åˆ": ["ä¸", "å·±"],
      "æœª": ["å·±", "ä¸", "ä¹™"], "ç”³": ["åºš", "å£¬", "æˆŠ"], "é…‰": ["è¾›"],
      "æˆŒ": ["æˆŠ", "è¾›", "ä¸"], "äº¥": ["å£¬", "ç”²"]
    };
    
    // çº³éŸ³è¡¨
    const NAYIN_TABLE = {
      "ç”²å­": "æµ·ä¸­é‡‘", "ä¹™ä¸‘": "æµ·ä¸­é‡‘", "ä¸™å¯…": "ç‚‰ä¸­ç«", "ä¸å¯": "ç‚‰ä¸­ç«",
      "æˆŠè¾°": "å¤§æ—æœ¨", "å·±å·³": "å¤§æ—æœ¨", "åºšåˆ": "è·¯æ—åœŸ", "è¾›æœª": "è·¯æ—åœŸ",
      "å£¬ç”³": "å‰‘é”‹é‡‘", "ç™¸é…‰": "å‰‘é”‹é‡‘", "ç”²æˆŒ": "å±±å¤´ç«", "ä¹™äº¥": "å±±å¤´ç«",
      "ä¸™å­": "æ¶§ä¸‹æ°´", "ä¸ä¸‘": "æ¶§ä¸‹æ°´", "æˆŠå¯…": "åŸå¤´åœŸ", "å·±å¯": "åŸå¤´åœŸ",
      "åºšè¾°": "ç™½èœ¡é‡‘", "è¾›å·³": "ç™½èœ¡é‡‘", "å£¬åˆ": "æ¨æŸ³æœ¨", "ç™¸æœª": "æ¨æŸ³æœ¨",
      "ç”²ç”³": "æ³‰ä¸­æ°´", "ä¹™é…‰": "æ³‰ä¸­æ°´", "ä¸™æˆŒ": "å±‹ä¸ŠåœŸ", "ä¸äº¥": "å±‹ä¸ŠåœŸ",
      "æˆŠå­": "éœ¹é›³ç«", "å·±ä¸‘": "éœ¹é›³ç«", "åºšå¯…": "æ¾æŸæœ¨", "è¾›å¯": "æ¾æŸæœ¨",
      "å£¬è¾°": "é•¿æµæ°´", "ç™¸å·³": "é•¿æµæ°´", "ç”²åˆ": "ç ‚ä¸­é‡‘", "ä¹™æœª": "ç ‚ä¸­é‡‘",
      "ä¸™ç”³": "å±±ä¸‹ç«", "ä¸é…‰": "å±±ä¸‹ç«", "æˆŠæˆŒ": "å¹³åœ°æœ¨", "å·±äº¥": "å¹³åœ°æœ¨",
      "åºšå­": "å£ä¸ŠåœŸ", "è¾›ä¸‘": "å£ä¸ŠåœŸ", "å£¬å¯…": "é‡‘ç®”é‡‘", "ç™¸å¯": "é‡‘ç®”é‡‘",
      "ç”²è¾°": "è¦†ç¯ç«", "ä¹™å·³": "è¦†ç¯ç«", "ä¸™åˆ": "å¤©æ²³æ°´", "ä¸æœª": "å¤©æ²³æ°´",
      "æˆŠç”³": "å¤§é©¿åœŸ", "å·±é…‰": "å¤§é©¿åœŸ", "åºšæˆŒ": "é’—é’é‡‘", "è¾›äº¥": "é’—é’é‡‘",
      "å£¬å­": "æ¡‘æŸ˜æœ¨", "ç™¸ä¸‘": "æ¡‘æŸ˜æœ¨", "ç”²å¯…": "å¤§æºªæ°´", "ä¹™å¯": "å¤§æºªæ°´",
      "ä¸™è¾°": "æ²™ä¸­åœŸ", "ä¸å·³": "æ²™ä¸­åœŸ", "æˆŠåˆ": "å¤©ä¸Šç«", "å·±æœª": "å¤©ä¸Šç«",
      "åºšç”³": "çŸ³æ¦´æœ¨", "è¾›é…‰": "çŸ³æ¦´æœ¨", "å£¬æˆŒ": "å¤§æµ·æ°´", "ç™¸äº¥": "å¤§æµ·æ°´"
    };
    
    // å¤©å¹²é˜´é˜³
    const GAN_YINYANG = {
      "ç”²": "é˜³", "ä¹™": "é˜´", "ä¸™": "é˜³", "ä¸": "é˜´", "æˆŠ": "é˜³", "å·±": "é˜´",
      "åºš": "é˜³", "è¾›": "é˜´", "å£¬": "é˜³", "ç™¸": "é˜´"
    };
    
    // äº”è¡Œç”Ÿå…‹å…³ç³»
    const SHENG_MAP = {"æœ¨": "ç«", "ç«": "åœŸ", "åœŸ": "é‡‘", "é‡‘": "æ°´", "æ°´": "æœ¨"};
    const KE_MAP = {"æœ¨": "åœŸ", "ç«": "é‡‘", "åœŸ": "æ°´", "é‡‘": "æœ¨", "æ°´": "ç«"};
    const SHENG_WO = Object.fromEntries(Object.entries(SHENG_MAP).map(([k, v]) => [v, k]));
    const KE_WO = Object.fromEntries(Object.entries(KE_MAP).map(([k, v]) => [v, k]));
    
    // è¿åŠ¿è§£é‡Š
    const YUNSHI_JIESHI = {
      "æ¯”è‚©": "è‡ªæˆ‘å¼ºåŒ–ä¹‹è¿ï¼Œé€‚åˆç‹¬ç«‹åˆ›ä¸šã€è‡ªä¸»å†³ç­–",
      "åŠ«è´¢": "ç«äº‰å‹åŠ›ä¹‹è¿ï¼Œéœ€æ³¨æ„åˆä½œå…³ç³»ä¸è´¢åŠ¡é£é™©",
      "é£Ÿç¥": "å®‰é€¸äº«ä¹ä¹‹è¿ï¼Œé€‚åˆåˆ›æ„è¡¨è¾¾ã€å­¦æœ¯æˆé•¿",
      "ä¼¤å®˜": "æ‰åé‡Šæ”¾ä¹‹è¿ï¼Œåˆ©äºå±•ç¤ºèƒ½åŠ›ï¼Œéœ€æ³¨æ„å¾—ç½ªæƒå¨",
      "æ­£è´¢": "ç¨³å¥æ±‚è´¢ä¹‹è¿ï¼Œé€‚åˆæŠ•èµ„ç†è´¢ã€ç§¯ç´¯è´¢å¯Œ",
      "åè´¢": "åé—¨ä¹‹è´¢ä¹‹è¿ï¼Œé€‚åˆæ¥è§¦æœºä¼šå‹é¡¹ç›®æˆ–è·¨ç•Œæ”¶ç›Š",
      "æ­£å®˜": "è§„èŒƒæˆé•¿ä¹‹è¿ï¼Œé€‚åˆæ™‹å‡è€ƒè¯•ã€å…¬åŠ¡ç”³æŠ¥ç­‰",
      "ä¸ƒæ€": "å‹åŠ›æŒ‘æˆ˜ä¹‹è¿ï¼Œåˆ©äºçªç ´ç“¶é¢ˆã€å±•ç°é¢†å¯¼åŠ›",
      "æ­£å°": "å­¦ä¹ ç§¯ç´¯ä¹‹è¿ï¼Œåˆ©äºæ·±é€ ã€æå‡å­¦å†ä¸èµ„å†",
      "åå°": "çµæ„Ÿä¸å†…çœä¹‹è¿ï¼Œé€‚åˆç ”ç©¶ã€å†™ä½œã€é™å¿ƒä¿®ç‚¼"
    };
    
    // å­¦æœ¯/äº‹ä¸šæ˜Ÿå«ä¹‰
    const CAREER_STAR_MEANING = {
      "é£Ÿç¥": "é€‚åˆåˆ›ä½œã€å†™ä½œã€äº«å—å­¦æœ¯å¸¦æ¥çš„æˆæœ",
      "ä¼¤å®˜": "åˆ©äºå‘è¡¨ã€è¾©è®ºã€å±•ç¤ºæ‰åï¼Œéœ€æ³¨æ„è¨€è¾é”‹èŠ’",
      "æ­£å°": "åˆ©äºå­¦ä¹ è€ƒè¯•ã€å–å¾—èµ„è´¨ã€å¸ˆæ‰¿ã€å­¦ä½",
      "ä¸ƒæ€": "é€‚åˆçªç ´å‹åŠ›æŒ‘æˆ˜ï¼Œæœ‰æœ›è„±é¢–è€Œå‡º"
    };
    
    // ç¥ç…æ•°æ®
    const TASK_YI_JISHEN = {
      "æŠ•ç¨¿": new Set(["æ–‡æ˜Œ", "å¤©ä¹™", "å­¦å ‚", "ç‰å ‚", "é‡‘åŒ®", "æœˆæ©", "å¤©å¾·", "é’é¾™"]),
      "è¿”ä¿®": new Set(["å¤©å¾·", "æœˆå¾·", "å…­åˆ", "è§£ç¥", "æ—¶å¾·", "æ—¶é˜³", "å¤©èµ¦", "ç‰å ‚"]),
      "ç›²å®¡": new Set(["é‡‘åŒ®", "å¤©ä¹™", "é’é¾™", "æ˜å ‚", "å¤©æ©", "å¤©å–œ", "ç¦ç”Ÿ", "ç‹æ—¥"]),
      "ç­”è¾©": new Set(["æ–‡æ˜Œ", "ä¸‰å¥‡", "å¤©å–œ", "é‡‘åŒ®", "ç‰å ‚", "å¤©åŒ»", "å¤©èµ¦", "æ˜å ‚", "å¤©å¾·åˆ"])
    };
    
    const TASK_JI_XIONGSHA = {
      "æŠ•ç¨¿": new Set(["å¤©è´¼", "æŠ«éº»", "ç ´æ—¥", "æ­»ç¥", "å°è€—", "æœˆç…", "åŠ«ç…", "è¡€å¿Œ"]),
      "è¿”ä¿®": new Set(["æœˆç ´", "æ—¥ç ´", "æ—¬ç©º", "å¤©è´¼", "å¤æ—¥", "æ­»æ°”", "æœˆåŒ", "æœˆå®³"]),
      "ç›²å®¡": new Set(["æŠ«éº»", "åŠ«ç…", "æœˆç…", "æ­»æ°”", "äº”é¬¼", "å¤©ç‹—", "ç™½è™"]),
      "ç­”è¾©": new Set(["å¤©è´¼", "æ­»æ°”", "äº”é¬¼", "æœˆåŒ", "æœ±é›€", "åœ°ç«", "ç™½è™", "å­¤é˜³"])
    };
    
    // ==================== å†œå†è½¬æ¢ç®—æ³• ====================
    
    // ç®€åŒ–çš„å†œå†æ•°æ®ï¼ˆ1900-2100å¹´ï¼‰
    const LUNAR_INFO = [
      0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
      0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
      0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
      0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
      0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557,
      0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5b0, 0x14573, 0x052b0, 0x0a9a8, 0x0e950, 0x06aa0,
      0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
      0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b6a0, 0x195a6,
      0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570,
      0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
      0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5,
      0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930,
      0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
      0x05aa0, 0x076a3, 0x096d0, 0x04afb, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45,
      0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0,
      0x14b63, 0x09370, 0x049f8, 0x04970, 0x064b0, 0x168a6, 0x0ea50, 0x06b20, 0x1a6c4, 0x0aae0,
      0x0a2e0, 0x0d2e3, 0x0c960, 0x0d557, 0x0d4a0, 0x0da50, 0x05d55, 0x056a0, 0x0a6d0, 0x055d4,
      0x052d0, 0x0a9b8, 0x0a950, 0x0b4a0, 0x0b6a6, 0x0ad50, 0x055a0, 0x0aba4, 0x0a5b0, 0x052b0,
      0x0b273, 0x06930, 0x07337, 0x06aa0, 0x0ad50, 0x14b55, 0x04b60, 0x0a570, 0x054e4, 0x0d160,
      0x0e968, 0x0d520, 0x0daa0, 0x16aa6, 0x056d0, 0x04ae0, 0x0a9d4, 0x0a2d0, 0x0d150, 0x0f252,
      0x0d520
    ];
    
    // è®¡ç®—å†œå†å¹´å¤©æ•°
    function lunarYearDays(year) {
      let sum = 348;
      for (let i = 0x8000; i > 0x8; i >>= 1) {
        sum += (LUNAR_INFO[year - 1900] & i) ? 1 : 0;
      }
      return sum + leapDays(year);
    }
    
    // è®¡ç®—å†œå†å¹´é—°æœˆå¤©æ•°
    function leapDays(year) {
      if (leapMonth(year)) {
        return (LUNAR_INFO[year - 1900] & 0x10000) ? 30 : 29;
      }
      return 0;
    }
    
    // è®¡ç®—å†œå†å¹´é—°æœˆ
    function leapMonth(year) {
      return LUNAR_INFO[year - 1900] & 0xf;
    }
    
    // è®¡ç®—å†œå†æœˆå¤©æ•°
    function monthDays(year, month) {
      return (LUNAR_INFO[year - 1900] & (0x10000 >> month)) ? 30 : 29;
    }
    
    // å…¬å†è½¬å†œå†
    function solarToLunar(date) {
      const baseDate = new Date(1900, 0, 31);
      const offset = Math.floor((date - baseDate) / 86400000);
      
      let lunarYear = 1900;
      let temp = 0;
      
      while (lunarYear < 2100 && offset > temp) {
        temp += lunarYearDays(lunarYear);
        lunarYear++;
      }
      
      if (offset < temp) {
        temp -= lunarYearDays(lunarYear - 1);
        lunarYear--;
      }
      
      let lunarMonth = 1;
      let leap = leapMonth(lunarYear);
      let isLeap = false;
      
      while (lunarMonth < 13 && offset > temp) {
        if (leap > 0 && lunarMonth === (leap + 1) && !isLeap) {
          lunarMonth--;
          isLeap = true;
          temp += leapDays(lunarYear);
        } else {
          temp += monthDays(lunarYear, lunarMonth);
        }
        
        if (isLeap && lunarMonth === (leap + 1)) {
          isLeap = false;
        }
        lunarMonth++;
      }
      
      if (offset < temp) {
        lunarMonth--;
        temp -= isLeap ? leapDays(lunarYear) : monthDays(lunarYear, lunarMonth);
      }
      
      const lunarDay = offset - temp + 1;
      
      return {
        year: lunarYear,
        month: lunarMonth,
        day: lunarDay,
        isLeap: isLeap
      };
    }
    
    // ==================== å…«å­—è®¡ç®—å‡½æ•° ====================
    
    // è®¡ç®—å¹²æ”¯
    function getGanZhi(num) {
      const gan = TIANGAN[num % 10];
      const zhi = DIZHI[num % 12];
      return gan + zhi;
    }
    
    // è®¡ç®—å¹´æŸ±
    function getYearGanZhi(year) {
      return getGanZhi(year - 4);
    }
    
    // è®¡ç®—æœˆæŸ±
    function getMonthGanZhi(year, month) {
      const yearGan = TIANGAN[(year - 4) % 10];
      const yearGanIndex = TIANGAN.indexOf(yearGan);
      
      // æœˆå¹²è®¡ç®—å…¬å¼
      const monthGanIndex = (yearGanIndex * 2 + month) % 10;
      const monthGan = TIANGAN[monthGanIndex];
      const monthZhi = DIZHI[(month + 1) % 12];
      
      return monthGan + monthZhi;
    }
    
    // è®¡ç®—æ—¥æŸ±
    function getDayGanZhi(date) {
      const baseDate = new Date(1900, 0, 1);
      const days = Math.floor((date - baseDate) / 86400000);
      return getGanZhi(days + 10);
    }
    
    // è®¡ç®—æ—¶æŸ±
    function getTimeGanZhi(date, dayGanZhi) {
      const hour = date.getHours();
      let timeZhiIndex;
      
      if (hour >= 23 || hour < 1) timeZhiIndex = 0; // å­æ—¶
      else if (hour < 3) timeZhiIndex = 1; // ä¸‘æ—¶
      else if (hour < 5) timeZhiIndex = 2; // å¯…æ—¶
      else if (hour < 7) timeZhiIndex = 3; // å¯æ—¶
      else if (hour < 9) timeZhiIndex = 4; // è¾°æ—¶
      else if (hour < 11) timeZhiIndex = 5; // å·³æ—¶
      else if (hour < 13) timeZhiIndex = 6; // åˆæ—¶
      else if (hour < 15) timeZhiIndex = 7; // æœªæ—¶
      else if (hour < 17) timeZhiIndex = 8; // ç”³æ—¶
      else if (hour < 19) timeZhiIndex = 9; // é…‰æ—¶
      else if (hour < 21) timeZhiIndex = 10; // æˆŒæ—¶
      else timeZhiIndex = 11; // äº¥æ—¶
      
      const dayGan = dayGanZhi[0];
      const dayGanIndex = TIANGAN.indexOf(dayGan);
      const timeGanIndex = (dayGanIndex * 2 + timeZhiIndex) % 10;
      
      return TIANGAN[timeGanIndex] + DIZHI[timeZhiIndex];
    }
    
    // è®¡ç®—å…«å­—
    function calculateBaZi(date) {
      const lunar = solarToLunar(date);
      
      const yearGZ = getYearGanZhi(lunar.year);
      const monthGZ = getMonthGanZhi(lunar.year, lunar.month);
      const dayGZ = getDayGanZhi(date);
      const timeGZ = getTimeGanZhi(date, dayGZ);
      
      return {
        year: yearGZ,
        month: monthGZ,
        day: dayGZ,
        time: timeGZ,
        lunar: lunar
      };
    }
    
    // è®¡ç®—çº³éŸ³
    function getNaYin(ganZhi) {
      return NAYIN_TABLE[ganZhi] || "æœªçŸ¥";
    }
    
    // è®¡ç®—åç¥
    function getTenGod(dayGan, otherGan) {
      const dayWx = GAN_WUXING[dayGan];
      const otherWx = GAN_WUXING[otherGan];
      
      const tenGodMap = {
        "åŒäº”è¡Œé˜³é˜³æˆ–é˜´é˜´": "æ¯”è‚©",
        "åŒäº”è¡Œé˜´é˜³ç›¸å¼‚": "åŠ«è´¢",
        "æˆ‘ç”Ÿè€…é˜³é˜³æˆ–é˜´é˜´": "é£Ÿç¥",
        "æˆ‘ç”Ÿè€…é˜´é˜³ç›¸å¼‚": "ä¼¤å®˜",
        "ç”Ÿæˆ‘è€…é˜³é˜³æˆ–é˜´é˜´": "æ­£å°",
        "ç”Ÿæˆ‘è€…é˜´é˜³ç›¸å¼‚": "åå°",
        "æˆ‘å…‹è€…é˜³é˜³æˆ–é˜´é˜´": "æ­£è´¢",
        "æˆ‘å…‹è€…é˜´é˜³ç›¸å¼‚": "åè´¢",
        "å…‹æˆ‘è€…é˜³é˜³æˆ–é˜´é˜´": "æ­£å®˜",
        "å…‹æˆ‘è€…é˜´é˜³ç›¸å¼‚": "ä¸ƒæ€"
      };
      
      let relation = "";
      if (otherWx === dayWx) {
        relation = "åŒäº”è¡Œ";
      } else if (SHENG_MAP[dayWx] === otherWx) {
        relation = "æˆ‘ç”Ÿè€…";
      } else if (SHENG_WO[dayWx] === otherWx) {
        relation = "ç”Ÿæˆ‘è€…";
      } else if (KE_MAP[dayWx] === otherWx) {
        relation = "æˆ‘å…‹è€…";
      } else if (KE_WO[dayWx] === otherWx) {
        relation = "å…‹æˆ‘è€…";
      } else {
        relation = "å…¶ä»–";
      }
      
      const yyMatch = GAN_YINYANG[dayGan] === GAN_YINYANG[otherGan] ? "é˜³é˜³æˆ–é˜´é˜´" : "é˜´é˜³ç›¸å¼‚";
      return tenGodMap[relation + yyMatch] || "æœªçŸ¥";
    }
    
    // åˆ†æäº”è¡Œå¼ºå¼±
    function analyzeWuXingStrength(baZi) {
      const ganZhiList = [baZi.year, baZi.month, baZi.day, baZi.time];
      const wuxingCount = {"æœ¨": 0, "ç«": 0, "åœŸ": 0, "é‡‘": 0, "æ°´": 0};
      
      // ç»Ÿè®¡å¤©å¹²
      ganZhiList.forEach(gz => {
        const gan = gz[0];
        if (GAN_WUXING[gan]) {
          wuxingCount[GAN_WUXING[gan]]++;
        }
      });
      
      // ç»Ÿè®¡è—å¹²
      ganZhiList.forEach(gz => {
        const zhi = gz[1];
        if (ZHI_CANGGAN[zhi]) {
          ZHI_CANGGAN[zhi].forEach(gan => {
            if (GAN_WUXING[gan]) {
              wuxingCount[GAN_WUXING[gan]]++;
            }
          });
        }
      });
      
      const dayGan = baZi.day[0];
      const dayWuxing = GAN_WUXING[dayGan];
      
      // åˆ¤æ–­å¼ºå¼±ï¼šå¾—ä»¤ã€å¾—åœ°ã€å¾—åŠ©
      const monthZhi = baZi.month[1];
      const deLing = ZHI_CANGGAN[monthZhi] && ZHI_CANGGAN[monthZhi].includes(dayGan);
      
      const otherZhi = [baZi.year[1], baZi.time[1]];
      const deDi = otherZhi.some(zhi => 
        ZHI_CANGGAN[zhi] && (
          ZHI_CANGGAN[zhi].includes(dayGan) ||
          ZHI_CANGGAN[zhi].some(gan => GAN_WUXING[gan] === SHENG_WO[dayWuxing])
        )
      );
      
      const otherGan = [baZi.year[0], baZi.month[0], baZi.time[0]];
      const deZhu = otherGan.some(gan => 
        GAN_WUXING[gan] === dayWuxing || GAN_WUXING[gan] === SHENG_WO[dayWuxing]
      );
      
      // å¼ºå¼±åˆ¤æ–­å¾—åˆ†æœºåˆ¶ï¼ˆ0~3ï¼‰
      const strengthScore = [deLing, deDi, deZhu].filter(Boolean).length;
      let status;
      if (strengthScore >= 2) {
        status = "æ—¥ä¸»åå¼º";
      } else if (strengthScore === 1) {
        status = "ä¸­å’Œ";
      } else {
        status = "æ—¥ä¸»åå¼±";
      }
      
      // ç”¨ç¥ä¸å¿Œç¥åˆ¤æ–­
      let yongShen, jiShen, xiShen;
      if (status === "æ—¥ä¸»åå¼º") {
        yongShen = [SHENG_MAP[dayWuxing], KE_MAP[dayWuxing]];
        jiShen = [dayWuxing, SHENG_WO[dayWuxing]];
        xiShen = ["--"];
      } else if (status === "æ—¥ä¸»åå¼±") {
        yongShen = [dayWuxing, SHENG_WO[dayWuxing]];
        jiShen = [KE_MAP[dayWuxing], SHENG_MAP[dayWuxing]];
        xiShen = ["--"];
      } else {
        // ä¸­å’Œæ ¼å±€
        const sortedWuxing = Object.entries(wuxingCount).sort((a, b) => a[1] - b[1]);
        xiShen = [sortedWuxing[0][0]];
        jiShen = [sortedWuxing[sortedWuxing.length - 1][0]];
        yongShen = ["ä¸­åº¸è°ƒå’Œ"];
      }
      
      return {
        dayGan,
        dayWuxing,
        status,
        wuxingCount,
        yongShen,
        xiShen,
        jiShen,
        deLing,
        deDi,
        deZhu
      };
    }
    
    // è®¡ç®—å¤§è¿
    function calculateDaYun(baZi, gender, currentYear) {
      const dayun = [];
      const birthYear = baZi.lunar.year;
      
      // ç®€åŒ–çš„å¤§è¿è®¡ç®—
      for (let i = 0; i < 8; i++) {
        const startAge = i * 10 + 1;
        const endAge = (i + 1) * 10;
        const startYear = birthYear + startAge;
        const endYear = birthYear + endAge;
        
        // ç®€åŒ–çš„å¤§è¿å¹²æ”¯è®¡ç®—
        const ganIndex = (TIANGAN.indexOf(baZi.month[0]) + i + (gender === 1 ? 1 : -1)) % 10;
        const zhiIndex = (DIZHI.indexOf(baZi.month[1]) + i + (gender === 1 ? 1 : -1)) % 12;
        const ganzhi = TIANGAN[ganIndex < 0 ? ganIndex + 10 : ganIndex] + 
                      DIZHI[zhiIndex < 0 ? zhiIndex + 12 : zhiIndex];
        
        dayun.push({
          index: i + 1,
          startAge,
          endAge,
          startYear,
          endYear,
          ganzhi
        });
      }
      
      return dayun;
    }
    
    // è®¡ç®—å½“å‰å¹´é¾„
    function calculateAge(birthDate, currentDate) {
      let age = currentDate.getFullYear() - birthDate.getFullYear();
      if ((currentDate.getMonth() < birthDate.getMonth()) || 
          (currentDate.getMonth() === birthDate.getMonth() && currentDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }
    
    // ç®€åŒ–çš„ç¥ç…è®¡ç®—
    function calculateShenSha(date, task) {
      // ç®€åŒ–ç‰ˆæœ¬ï¼Œéšæœºç”Ÿæˆä¸€äº›ç¥ç…ç”¨äºæ¼”ç¤º
      const allJiShen = ["æ–‡æ˜Œ", "å¤©ä¹™", "å­¦å ‚", "ç‰å ‚", "é‡‘åŒ®", "æœˆæ©", "å¤©å¾·", "é’é¾™", "æ˜å ‚", "å¤©æ©", "å¤©å–œ", "ç¦ç”Ÿ", "ç‹æ—¥"];
      const allXiongSha = ["å¤©è´¼", "æŠ«éº»", "ç ´æ—¥", "æ­»ç¥", "å°è€—", "æœˆç…", "åŠ«ç…", "è¡€å¿Œ", "æœˆç ´", "æ—¥ç ´", "æ—¬ç©º", "å¤æ—¥", "æ­»æ°”", "æœˆåŒ", "æœˆå®³"];
      
      // åŸºäºæ—¥æœŸç”Ÿæˆä¼ªéšæœºç¥ç…
      const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
      const jiShenCount = (dayOfYear % 4) + 1;
      const xiongShaCount = (dayOfYear % 3) + 1;
      
      const jiShen = [];
      const xiongSha = [];
      
      for (let i = 0; i < jiShenCount; i++) {
        const index = (dayOfYear + i) % allJiShen.length;
        jiShen.push(allJiShen[index]);
      }
      
      for (let i = 0; i < xiongShaCount; i++) {
        const index = (dayOfYear + i + 7) % allXiongSha.length;
        xiongSha.push(allXiongSha[index]);
      }
      
      return { jiShen, xiongSha };
    }
    
    // æ‹©å‰è¯„åˆ†ç®—æ³•
    function evaluateDayForTask(date, task, yongShen, jiShen, dayGan, daYunTenGod, liuNianTenGod, liuYueTenGod) {
      try {
        const baZi = calculateBaZi(date);
        const dayGanCurr = baZi.day[0];
        const dayZhiCurr = baZi.day[1];
        const dayGanWx = GAN_WUXING[dayGanCurr];
        const dayZhiWx = ZHI_WUXING[dayZhiCurr];
        
        const shenSha = calculateShenSha(date, task);
        const jiShenSet = new Set(shenSha.jiShen);
        const xiongShaSet = new Set(shenSha.xiongSha);
        
        let score = 0;
        
        // ç¥ç…è¯„åˆ†
        const taskYiJiShen = TASK_YI_JISHEN[task] || new Set();
        const taskJiXiongSha = TASK_JI_XIONGSHA[task] || new Set();
        
        score += Array.from(jiShenSet).filter(x => taskYiJiShen.has(x)).length * 1.5;
        score -= Array.from(xiongShaSet).filter(x => taskJiXiongSha.has(x)).length * 2;
        
        // ç”¨ç¥ä¸å¿Œç¥è¯„åˆ†
        if (yongShen.includes(dayGanWx)) score += 2;
        if (yongShen.includes(dayZhiWx)) score += 1;
        if (jiShen.includes(dayGanWx)) score -= 2;
        if (jiShen.includes(dayZhiWx)) score -= 1;
        
        // è¿åŠ¿è¯„åˆ†
        [daYunTenGod, liuNianTenGod, liuYueTenGod].forEach(tg => {
          if (["é£Ÿç¥", "ä¼¤å®˜", "æ­£å°", "ä¸ƒæ€"].includes(tg)) {
            score += 1;
          }
        });
        
        return {
          date: date.toISOString().split('T')[0],
          ganzhi: dayGanCurr + dayZhiCurr,
          jiShen: Array.from(jiShenSet),
          xiongSha: Array.from(xiongShaSet),
          wuxing: `${dayGanWx}/${dayZhiWx}`,
          score: Math.round(score * 100) / 100
        };
      } catch (e) {
        return {
          date: date.toISOString().split('T')[0],
          ganzhi: "è®¡ç®—å¤±è´¥",
          jiShen: [],
          xiongSha: [],
          wuxing: "æœªçŸ¥/æœªçŸ¥",
          score: 0,
          error: e.message
        };
      }
    }
    
    // ==================== ä¸»åˆ†æå‡½æ•° ====================
    
    function runBaziAnalysis(birthDateTime, gender, task, days, currentTime) {
      const result = {
        prints: [],
        data: {}
      };
      
      try {
        // è®¡ç®—å…«å­—
        const baZi = calculateBaZi(birthDateTime);
        const ganZhiList = [baZi.year, baZi.month, baZi.day, baZi.time];
        
        result.data.gan_zhi = ganZhiList;
        result.prints.push(`\n\n âœ¨ å…«å­—åˆ†æç»“æœ âœ¨\nå¹²æ”¯åˆ—è¡¨: ${ganZhiList.join(' ')}`);
        
        // çº³éŸ³ä¿¡æ¯
        const nayin = {
          year: getNaYin(baZi.year),
          month: getNaYin(baZi.month),
          day: getNaYin(baZi.day),
          time: getNaYin(baZi.time)
        };
        result.data.nayin = nayin;
        result.prints.push(`çº³éŸ³ï¼šå¹´:${nayin.year},æœˆ:${nayin.month},æ—¥:${nayin.day},æ—¶:${nayin.time}`);
        
        // åç¥ä¿¡æ¯
        const dayGan = baZi.day[0];
        const shishenGan = {
          year: getTenGod(dayGan, baZi.year[0]),
          month: getTenGod(dayGan, baZi.month[0]),
          day: getTenGod(dayGan, dayGan),
          time: getTenGod(dayGan, baZi.time[0])
        };
        result.data.shishen_gan = shishenGan;
        result.prints.push(`å¹²åç¥ï¼šå¹´:${shishenGan.year},æœˆ:${shishenGan.month},æ—¥:${shishenGan.day},æ—¶:${shishenGan.time}`);
        
        // å¼ºå¼±åˆ†æ
        const qiangruo = analyzeWuXingStrength(baZi);
        result.data.qiangruo = {
          æ—¥ä¸»: qiangruo.dayGan,
          äº”è¡Œ: qiangruo.dayWuxing,
          æ—¥ä¸»å¼ºå¼±: qiangruo.status,
          äº”è¡Œåˆ†å¸ƒ: qiangruo.wuxingCount,
          ç”¨ç¥: qiangruo.yongShen,
          å–œç¥æ¨è: qiangruo.xiShen,
          å¿Œç¥å»ºè®®: qiangruo.jiShen
        };
        
        result.prints.push(`\nã€æ—¥ä¸»ã€‘ï¼š${qiangruo.dayGan}ï¼ˆäº”è¡Œï¼š${qiangruo.dayWuxing}ï¼‰`);
        result.prints.push(`ã€æ—¥ä¸»å¼ºå¼±ã€‘ï¼š${qiangruo.status}ï¼ˆå¾—ä»¤ï¼š${qiangruo.deLing}ï¼Œå¾—åœ°ï¼š${qiangruo.deDi}ï¼Œå¾—åŠ©ï¼š${qiangruo.deZhu}ï¼‰`);
        result.prints.push(`ã€äº”è¡Œåˆ†å¸ƒã€‘ï¼š${JSON.stringify(qiangruo.wuxingCount)}`);
        result.prints.push(`ã€ç”¨ç¥æ¨èã€‘ï¼š${qiangruo.yongShen.join(', ')}`);
        result.prints.push(`ã€å–œç¥æ¨èã€‘ï¼š${qiangruo.xiShen.join(', ')}`);
        result.prints.push(`ã€å¿Œç¥å»ºè®®ã€‘ï¼š${qiangruo.jiShen.join(', ')}`);
        
        // å¤§è¿åˆ†æ
        const dayun = calculateDaYun(baZi, gender, currentTime.getFullYear());
        result.data.dayun = dayun;
        
        result.prints.push("\nå¤§è¿ï¼š");
        dayun.forEach(d => {
          result.prints.push(`${d.startAge}å²-${d.endAge}å²ï¼šç¬¬${d.index}è½®å¤§è¿ï¼Œ${d.ganzhi}`);
        });
        
        // å½“å‰å¹´é¾„
        const age = calculateAge(birthDateTime, currentTime);
        result.data.current_age = age;
        result.prints.push(`å½“å‰å¹´é¾„: ${age}å²`);
        
        // å½“å‰å¤§è¿
        const currentDayun = dayun.find(d => d.startYear <= currentTime.getFullYear() && currentTime.getFullYear() <= d.endYear);
        
        if (currentDayun) {
          result.data.current_dayun = {
            basic: {
              ganzhi: currentDayun.ganzhi,
              age_range: `${currentDayun.startAge}~${currentDayun.endAge}å²`
            }
          };
          
          result.prints.push(`\nğŸ¯ å½“å‰æ‰€åœ¨å¤§è¿ï¼š${currentDayun.ganzhi} (${currentDayun.startAge}~${currentDayun.endAge}å²)`);
          
          // å½“å‰è¿åŠ¿åç¥åˆ†æ
          const currentBaZi = calculateBaZi(currentTime);
          const daYunGan = currentDayun.ganzhi[0];
          const liuNianGan = currentBaZi.year[0];
          const liuYueGan = currentBaZi.month[0];
          
          const daYunTenGod = getTenGod(dayGan, daYunGan);
          const liuNianTenGod = getTenGod(dayGan, liuNianGan);
          const liuYueTenGod = getTenGod(dayGan, liuYueGan);
          
          const interpretations = {
            dayun: `\nã€å½“å‰å¤§è¿ã€‘ï¼š${currentDayun.ganzhi}ï¼ˆåç¥ï¼š${daYunTenGod}ï¼‰â†’ ${YUNSHI_JIESHI[daYunTenGod] || 'æ— æ˜ç¡®è¿åŠ¿'}`,
            liunian: `ã€å½“å‰æµå¹´ã€‘ï¼š${currentBaZi.year}ï¼ˆåç¥ï¼š${liuNianTenGod}ï¼‰â†’ ${YUNSHI_JIESHI[liuNianTenGod] || 'æ— æ˜ç¡®è¿åŠ¿'}`,
            liuyue: `ã€å½“å‰æµæœˆã€‘ï¼š${currentBaZi.month}ï¼ˆåç¥ï¼š${liuYueTenGod}ï¼‰â†’ ${YUNSHI_JIESHI[liuYueTenGod] || 'æ— æ˜ç¡®è¿åŠ¿'}`
          };
          
          result.data.current_dayun.interpretations = interpretations;
          result.prints.push(interpretations.dayun);
          result.prints.push(interpretations.liunian);
          result.prints.push(interpretations.liuyue);
          
          // å­¦æœ¯/äº‹ä¸šæ˜Ÿåˆ†æ
          const careerStars = new Set(Object.keys(CAREER_STAR_MEANING));
          const activeStars = {
            "å¤§è¿": daYunTenGod,
            "æµå¹´": liuNianTenGod,
            "æµæœˆ": liuYueTenGod
          };
          
          const highlight = Object.fromEntries(
            Object.entries(activeStars).filter(([k, v]) => careerStars.has(v))
          );
          
          if (Object.keys(highlight).length > 0) {
            result.data.current_dayun.xingyao = [];
            Object.entries(highlight).forEach(([period, star]) => {
              const meaning = CAREER_STAR_MEANING[star];
              result.data.current_dayun.xingyao.push({
                period,
                star,
                meaning,
                period_explanation: `${period}è¿åŠ¿å½±å“`
              });
            });
          }
          
          // æ‹©å‰åˆ†æ
          const startDay = new Date(currentTime);
          const allResults = [];
          
          for (let i = 0; i < days; i++) {
            const d = new Date(startDay);
            d.setDate(startDay.getDate() + i);
            const result1 = evaluateDayForTask(
              d, task, qiangruo.yongShen, qiangruo.jiShen, dayGan,
              daYunTenGod, liuNianTenGod, liuYueTenGod
            );
            allResults.push(result1);
          }
          
          // æ¨èæ—¥å¤„ç†
          let goodDays = allResults.filter(r => r.score >= 2);
          
          result.data.days = {
            task: task,
            recommend_days: [],
            highest_scores: []
          };
          
          let printsBuffer = [`\nğŸ“… æœªæ¥${days}å¤©æ‹©å‰æ¨èï¼ˆä»»åŠ¡ï¼š${task}ï¼‰ï¼š`];
          
          if (goodDays.length === 0) {
            printsBuffer.push(`\nâš ï¸ æ— å¾—åˆ† â‰¥ 2 çš„æ¨èæ—¥ï¼Œæ¨èå¾—åˆ†æœ€é«˜çš„å‰ä¸‰æ—¥ï¼š`);
            goodDays = allResults.sort((a, b) => b.score - a.score).slice(0, 3);
            result.data.days.recommend_type = 'highest_scores';
            result.data.days.highest_scores = goodDays.map(d => d.score);
          } else {
            printsBuffer.push(`\nğŸ“… æ‰¾åˆ° ${goodDays.length} ä¸ªæ¨èæ—¥ï¼š`);
            result.data.days.recommend_type = 'qualified';
          }
          
          goodDays.forEach((day, idx) => {
            printsBuffer.push(`\nğŸ¯ æ¨èæ—¥${idx + 1}ï¼š${day.date} | å¾—åˆ†ï¼š${day.score}`);
            printsBuffer.push(`æ—¥å¹²æ”¯ï¼š${day.ganzhi}ï¼Œäº”è¡Œï¼š${day.wuxing}`);
            printsBuffer.push(`å‰ç¥ï¼š${day.jiShen.join('ã€') || 'æ— '}`);
            printsBuffer.push(`å‡¶ç…ï¼š${day.xiongSha.join('ã€') || 'æ— '}`);
            
            result.data.days.recommend_days.push({
              ranking: idx + 1,
              date: day.date,
              score: day.score,
              ganzhi: day.ganzhi,
              wuxing: {
                gan: day.wuxing.split('/')[0],
                zhi: day.wuxing.split('/')[1]
              },
              auspicious: day.jiShen,
              inauspicious: day.xiongSha
            });
          });
          
          result.prints = printsBuffer.concat(result.prints);
        }
        
        return result;
        
      } catch (e) {
        result.prints.push(`åˆ†æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${e.message}`);
        return result;
      }
    }
    
    // ==================== è¡¨å•æäº¤å‡½æ•° ====================
    
    function submitForm() {
      const birth = document.getElementById('birth').value;
      const gender = parseInt(document.getElementById('gender').value);
      const task = document.getElementById('task').value;
      const days = parseInt(document.getElementById('days').value);

      // è¾“å…¥éªŒè¯
      if (!birth) {
        alert("âš ï¸ è¯·è¾“å…¥å‡ºç”Ÿæ—¥æœŸå’Œæ—¶é—´ï¼");
        return;
      }

      if (days < 1 || days > 365) {
        alert("âš ï¸ åˆ†æå¤©æ•°å¿…é¡»åœ¨1-365ä¹‹é—´ï¼");
        return;
      }

      const resultBox = document.getElementById('result');
      resultBox.className = 'loading';
      resultBox.innerText = "â³ æ­£åœ¨åˆ†æå…«å­—ä¿¡æ¯ï¼Œè¯·ç¨å€™...\n\nè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´æ¥è®¡ç®—æ‚¨çš„å‘½ç†ä¿¡æ¯å’Œæ‹©å‰æ¨èã€‚";

      // ä½¿ç”¨setTimeoutæ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
      setTimeout(() => {
        try {
          const birthDateTime = new Date(birth);
          const currentTime = new Date();
          
          const analysisResult = runBaziAnalysis(birthDateTime, gender, task, days, currentTime);
          
          resultBox.className = 'success';
          
          // æ ¼å¼åŒ–è¾“å‡ºç»“æœ
          let formattedResult = "";
          formattedResult += "=".repeat(50) + "\n\n";
          
          analysisResult.prints.forEach(line => {
            if (line.includes('ğŸ¯') || line.includes('ğŸ“…')) {
              formattedResult += "\n" + line + "\n";
            } else if (line.includes('ã€') && line.includes('ã€‘')) {
              formattedResult += "\n" + line + "\n";
            } else {
              formattedResult += line + "\n";
            }
          });
          
          resultBox.innerText = formattedResult;
          
          // å¦‚æœæœ‰å­¦æœ¯/äº‹ä¸šæ˜Ÿæ›œ
          if (analysisResult.data.current_dayun && analysisResult.data.current_dayun.xingyao && analysisResult.data.current_dayun.xingyao.length > 0) {
            const xingyaoList = analysisResult.data.current_dayun.xingyao;
            resultBox.innerText += "\n\nğŸ“ å­¦æœ¯/äº‹ä¸šæ˜Ÿæ›œæç¤º:\n";
            xingyaoList.forEach(x => {
              resultBox.innerText += `ã€${x.period}ã€‘å‡ºç°é‡‘æ›œã€${x.star}ã€‘ï¼š${x.meaning}\n`;
              resultBox.innerText += `è¯´æ˜ï¼š${x.period_explanation}\n`;
            });
          } else {
            resultBox.innerText += "\n\nâš ï¸ å½“å‰é˜¶æ®µæš‚æ— å¯¹å­¦æœ¯/äº‹ä¸šæœ‰åˆ©çš„æ˜Ÿæ›œæç¤º\n";
          }
          
          // æ·»åŠ æ•°æ®æ‘˜è¦
          if (analysisResult.data.qiangruo) {
            const summary = analysisResult.data.qiangruo;
            resultBox.innerText += "\n\nğŸ“‹ åˆ†ææ‘˜è¦:\n";
            resultBox.innerText += `æ—¥ä¸»: ${summary.æ—¥ä¸»} (${summary.äº”è¡Œ})\n`;
            resultBox.innerText += `å¼ºå¼±: ${summary.æ—¥ä¸»å¼ºå¼±}\n`;
            resultBox.innerText += `ç”¨ç¥: ${summary.ç”¨ç¥.join(', ')}\n`;
            resultBox.innerText += `å¿Œç¥: ${summary.å¿Œç¥å»ºè®®.join(', ')}\n`;
          }
          
        } catch (error) {
          resultBox.className = 'error';
          resultBox.innerText = "âŒ åˆ†æå¤±è´¥ï¼š" + error.message;
          console.error('åˆ†æé”™è¯¯:', error);
        }
      }, 1000);
    }

    // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤å€¼
    window.onload = function() {
      // è®¾ç½®é»˜è®¤å‡ºç”Ÿæ—¶é—´ä¸º1990å¹´1æœˆ1æ—¥12:00
      const defaultDate = new Date('1990-01-01T12:00');
      const dateString = defaultDate.toISOString().slice(0, 16);
      document.getElementById('birth').value = dateString;
    };
  </script>
</body>
</html>
